<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Multi Uploader | Haruna Lawali</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- You can still use your style.css if you want, but here is improved internal CSS below -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <style>
      :root {
        --main: #2b4162;
        --accent: #0b6e4f;
        --bg: #f1f6f9;
        --white: #fff;
        --gray: #eaeaea;
        --danger: #f87171;
        --shadow: 0 8px 24px rgba(43,65,98,0.08);
      }

      body {
        margin: 0;
        font-family: 'Segoe UI', 'Arial', sans-serif;
        background: var(--bg);
        min-height: 100vh;
      }

      .container {
        max-width: 430px;
        margin: 40px auto;
        background: var(--white);
        box-shadow: var(--shadow);
        border-radius: 18px;
        padding: 24px 20px 30px 20px;
        position: relative;
      }

      header h1 {
        font-size: 1.38rem;
        margin: 0 0 16px 0;
        color: var(--main);
        text-align: center;
        font-weight: 700;
      }

      .upload-buttons {
        display: flex;
        gap: 8px;
        margin-bottom: 18px;
        justify-content: center;
      }

      .upload-buttons button {
        flex: 1;
        background: var(--accent);
        color: var(--white);
        border: none;
        font-size: 1rem;
        padding: 12px 0;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 500;
        transition: background .18s;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 7px;
      }
      .upload-buttons button:hover {
        background: #09714c;
      }

      #previewSection {
        background: var(--gray);
        margin-top: 12px;
        padding: 15px 15px 10px 15px;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(43,65,98,0.08);
      }
      #previewSection.hidden {
        display: none;
      }

      .preview-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
      }
      #previewType {
        font-weight: 600;
        color: var(--main);
        font-size: 1.1rem;
        letter-spacing: .1px;
      }
      #removeBtn {
        background: none;
        border: none;
        font-size: 1.25rem;
        color: var(--danger);
        cursor: pointer;
        transition: color .18s;
      }
      #removeBtn:hover {
        color: #dc2626;
      }

      .media-preview {
        display: flex;
        justify-content: center;
        align-items: center;
        margin-bottom: 12px;
        min-height: 110px;
      }

      .media-preview img,
      .media-preview video,
      .media-preview audio {
        max-width: 98%;
        max-height: 180px;
        border-radius: 7px;
        background: #fff;
        box-shadow: 0 1px 3px rgba(43,65,98,0.09);
      }

      .media-preview audio {
        width: 100%;
        outline: none;
      }

      .audio-record {
        width: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        margin-bottom: 8px;
      }
      .audio-record .controls {
        display: flex;
        gap: 8px;
        margin-bottom: 7px;
      }
      .audio-record button {
        background: var(--accent);
        color: var(--white);
        border: none;
        border-radius: 6px;
        padding: 6px 14px;
        font-size: 1rem;
        cursor: pointer;
        transition: background .18s;
      }
      .audio-record button:disabled {
        opacity: 0.6;
        cursor: not-allowed;
      }
      .audio-record button:hover:not(:disabled) {
        background: #09714c;
      }
      .audio-record .timer {
        font-size: 1.08rem;
        color: var(--main);
        font-weight: bold;
      }

      .link-actions {
        display: flex;
        gap: 7px;
        margin-top: 3px;
      }
      .link-actions.hidden {
        display: none;
      }
      #fileLink {
        flex: 1;
        font-size: .98rem;
        padding: 6px 8px;
        border: 1px solid #d6d7e0;
        border-radius: 6px;
        background: #f8fafc;
        color: #324;
        overflow-x: auto;
      }
      #copyBtn {
        background: var(--accent);
        color: var(--white);
        border: none;
        border-radius: 6px;
        padding: 5px 10px;
        font-size: 1.15rem;
        cursor: pointer;
        transition: background .18s;
      }
      #copyBtn:hover {
        background: #09714c;
      }

      #notif {
        position: fixed;
        bottom: 22px;
        left: 50%;
        transform: translateX(-50%);
        background: var(--accent);
        color: var(--white);
        padding: 10px 28px;
        border-radius: 8px;
        font-size: 1rem;
        opacity: 0;
        pointer-events: none;
        transition: opacity .26s;
        z-index: 100;
      }

      #notif.show {
        opacity: 1;
        pointer-events: auto;
      }

      @media (max-width: 500px) {
        .container {
          max-width: 98vw;
          padding: 13px 3vw 20px 3vw;
        }
        .media-preview img, .media-preview video, .media-preview audio {
          max-width: 96vw;
        }
      }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Welcome Haruna Lawali,</h1>
    </header>
    <div class="upload-buttons">
      <button id="videoBtn"><i class="fa-solid fa-video"></i> Upload Video</button>
      <button id="imageBtn"><i class="fa-solid fa-image"></i> Upload Image</button>
      <button id="audioBtn"><i class="fa-solid fa-music"></i> Upload Audio</button>
    </div>
    <input type="file" id="fileInput" hidden>
    <!-- Audio recording UI, show only if needed -->
    <section class="audio-record" id="audioRecordSection" style="display:none;">
      <div class="controls">
        <button id="startRecBtn"><i class="fa-solid fa-microphone"></i> Start</button>
        <button id="stopRecBtn" disabled><i class="fa-solid fa-stop"></i> Stop</button>
        <span class="timer" id="recTimer">00:00</span>
      </div>
      <audio id="recordedAudio" controls style="display:none;"></audio>
      <button id="useRecordedBtn" style="display:none;">Use & Upload</button>
    </section>
    <section id="previewSection" class="hidden">
      <div class="preview-header">
        <span id="previewType"></span>
        <button id="removeBtn" title="Remove"><i class="fa-solid fa-xmark"></i></button>
      </div>
      <div class="media-preview" id="mediaPreview"></div>
      <div class="link-actions hidden" id="linkActions">
        <input type="text" readonly id="fileLink">
        <button id="copyBtn" title="Copy Link"><i class="fa-regular fa-copy"></i></button>
      </div>
    </section>
    <div id="notif"></div>
  </div>
  <script>
    // ========== DOM ELEMENTS ==========
    const fileInput = document.getElementById("fileInput");
    const videoBtn = document.getElementById("videoBtn");
    const imageBtn = document.getElementById("imageBtn");
    const audioBtn = document.getElementById("audioBtn");
    const previewSection = document.getElementById("previewSection");
    const previewType = document.getElementById("previewType");
    const mediaPreview = document.getElementById("mediaPreview");
    const removeBtn = document.getElementById("removeBtn");
    const linkActions = document.getElementById("linkActions");
    const fileLink = document.getElementById("fileLink");
    const copyBtn = document.getElementById("copyBtn");
    const notif = document.getElementById("notif");

    // Audio record UI
    const audioRecordSection = document.getElementById("audioRecordSection");
    const startRecBtn = document.getElementById("startRecBtn");
    const stopRecBtn = document.getElementById("stopRecBtn");
    const recTimer = document.getElementById("recTimer");
    const recordedAudio = document.getElementById("recordedAudio");
    const useRecordedBtn = document.getElementById("useRecordedBtn");

    let currentType = null;
    let lastFile = null;
    let recChunks = [];
    let recMediaRecorder = null;
    let recStartTime = null;
    let recInterval = null;
    let recBlob = null;

    function showNotif(msg, color) {
      notif.textContent = msg;
      notif.style.background = color || 'var(--accent)';
      notif.classList.add('show');
      setTimeout(() => notif.classList.remove('show'), 1700);
    }

    // ========== UPLOAD BUTTONS ==========
    videoBtn.onclick = () => {
      audioRecordSection.style.display = 'none';
      openFilePicker("video/*", "video");
    };
    imageBtn.onclick = () => {
      audioRecordSection.style.display = 'none';
      openFilePicker("image/*", "image");
    };
    audioBtn.onclick = () => {
      // Show record UI and file picker for audio
      audioRecordSection.style.display = '';
      previewSection.classList.add("hidden");
      linkActions.classList.add("hidden");
      // Also allow picking audio file if preferred
      openFilePicker("audio/*,audio/webm", "audio");
    };

    function openFilePicker(accept, type) {
      fileInput.value = "";
      fileInput.accept = accept;
      fileInput.multiple = false;
      currentType = type;
      fileInput.click();
    }

    // ========== FILE SELECTION HANDLER ==========
    fileInput.onchange = async (e) => {
      const file = e.target.files[0];
      if (!file) return;
      if (currentType === "video" && file.size > 210 * 1024 * 1024) {
        showNotif("Video ya fi 200MB. Zabi wata video", "var(--danger)");
        return;
      }
      if (currentType === "image" && file.size > 32 * 1024 * 1024) {
        showNotif("Image ya fi 32MB. Zabi wata image", "var(--danger)");
        return;
      }
      if (currentType === "audio" && file.size > 70 * 1024 * 1024) {
        showNotif("Audio ya fi 70MB. Zabi wata audio", "var(--danger)");
        return;
      }
      showPreview(file, currentType);
      lastFile = file;
      previewType.textContent = "Uploading...";
      linkActions.classList.add("hidden");
      await doUpload(file, currentType);
    };

    // ========== PREVIEW ==========
    function showPreview(file, type) {
      previewSection.classList.remove("hidden");
      let url = URL.createObjectURL(file);
      let el;
      if (type === "image") {
        el = document.createElement("img");
        el.src = url;
        el.alt = "uploaded image";
      } else if (type === "video") {
        el = document.createElement("video");
        el.src = url;
        el.controls = true;
      } else if (type === "audio") {
        el = document.createElement("audio");
        el.src = url;
        el.controls = true;
      }
      mediaPreview.innerHTML = "";
      mediaPreview.appendChild(el);
    }

    removeBtn.onclick = () => {
      previewSection.classList.add("hidden");
      mediaPreview.innerHTML = "";
      lastFile = null;
      linkActions.classList.add("hidden");
    };

    // ========== IMAGE UPLOAD (IMGUR + fallback POSTIMAGES) ==========
    async function compressImage(file) {
      // Basic browser compression (no external lib for size)
      return new Promise((resolve, reject) => {
        const img = new Image();
        const reader = new FileReader();
        reader.onload = ev => {
          img.onload = () => {
            let scale = 1;
            const maxDim = 1024;
            if (img.width > maxDim || img.height > maxDim) {
              scale = Math.min(maxDim / img.width, maxDim / img.height);
            }
            const canvas = document.createElement("canvas");
            canvas.width = img.width * scale;
            canvas.height = img.height * scale;
            canvas.getContext("2d").drawImage(img, 0, 0, canvas.width, canvas.height);
            canvas.toBlob(blob => {
              const random4 = Math.random().toString(36).substring(2, 6);
              resolve(new File([blob], `${random4}_${Date.now()}.png`, { type: "image/png" }));
            }, "image/png", 0.7);
          };
          img.onerror = reject;
          img.src = ev.target.result;
        };
        reader.onerror = reject;
        reader.readAsDataURL(file);
      });
    }

    async function uploadToImgur(file) {
      const formData = new FormData();
      formData.append('image', file);
      const response = await fetch('https://api.imgur.com/3/image', {
        method: 'POST',
        headers: { Authorization: 'Client-ID 5acf7eff9c91660' },
        body: formData,
      });
      const data = await response.json();
      if (data.success && data.data && data.data.link) return data.data.link;
      throw new Error('Imgur upload failed');
    }

    async function uploadToPostImages(file) {
      const formData = new FormData();
      formData.append('file', file);
      formData.append('upload_session', '');
      const response = await fetch('https://api.postimages.org/1/upload', {
        method: 'POST',
        body: formData,
      });
      const data = await response.json();
      if (data.url) return data.url;
      throw new Error('PostImages upload failed');
    }

    async function uploadImageWorkflow(file) {
      const compressed = await compressImage(file);
      try {
        return await uploadToImgur(compressed);
      } catch (e) {
        try {
          return await uploadToPostImages(compressed);
        } catch (err) {
          throw new Error('All image uploads failed');
        }
      }
    }

    // ========== AUDIO UPLOAD (webm only, Catbox + fallback Anonfiles) ==========
    async function prepareAudioFile(file) {
      // Make sure file is .mp3 or .webm, else convert name (no ffmpeg)
      let ext = file.name.split('.').pop().toLowerCase();
      let base = file.name.replace(/\.[^/.]+$/, '');
      if (ext !== 'mp3' && ext !== 'webm') {
        ext = 'mp3';
      }
      return new File([file], `${base}.` + ext, { type: file.type });
    }

    async function uploadToCatbox(file) {
      // Catbox
      const formData = new FormData();
      formData.append("reqtype", "fileupload");
      formData.append("fileToUpload", file);
      const response = await fetch("https://catbox.moe/user/api.php", {
        method: "POST",
        body: formData
      });
      const url = await response.text();
      if (url.startsWith('http')) return url;
      throw new Error("Catbox upload failed");
    }

    async function uploadToAnonfiles(file) {
      const formData = new FormData();
      formData.append('file', file);
      const response = await fetch('https://api.anonfiles.com/upload', {
        method: 'POST',
        body: formData,
      });
      const data = await response.json();
      if (data.status && data.data && data.data.file && data.data.file.url && data.data.file.url.full) {
        return data.data.file.url.full;
      }
      throw new Error('Anonfiles upload failed');
    }

    async function uploadAudioWorkflow(file) {
      const prepared = await prepareAudioFile(file);
      try {
        return await uploadToCatbox(prepared);
      } catch (e) {
        try {
          return await uploadToAnonfiles(prepared);
        } catch (err) {
          throw new Error('All audio uploads failed');
        }
      }
    }

    // ========== MAIN UPLOAD LOGIC ==========
    async function doUpload(file, type) {
      previewType.textContent = {
        image: "Uploading Image...",
        video: "Uploading Video...",
        audio: "Uploading Audio..."
      }[type];

      let url = '';
      try {
        if (type === "image") {
          url = await uploadImageWorkflow(file);
        } else if (type === "video") {
          url = await uploadToCatbox(file, type);
        } else if (type === "audio") {
          url = await uploadAudioWorkflow(file);
        }
        if (!url) throw new Error("Bai samu link ba");
        previewType.textContent = capitalize(type) + " Uploaded!";
        fileLink.value = url;
        linkActions.classList.remove("hidden");
        showNotif(capitalize(type) + " uploaded successfully!");
      } catch (err) {
        previewType.textContent = "Upload error!";
        showNotif("Error: " + (err.message || err), "var(--danger)");
      }
    }

    // ========== AUDIO RECORDING (webm) ==========
    let mediaStream = null;
    startRecBtn.onclick = async () => {
      recChunks = [];
      recBlob = null;
      recordedAudio.style.display = "none";
      useRecordedBtn.style.display = "none";
      recTimer.textContent = "00:00";
      try {
        mediaStream = await navigator.mediaDevices.getUserMedia({ audio: true });
        recMediaRecorder = new MediaRecorder(mediaStream, { mimeType: "audio/webm" });
        recMediaRecorder.ondataavailable = (e) => recChunks.push(e.data);
        recMediaRecorder.onstop = () => {
          recBlob = new Blob(recChunks, { type: "audio/webm" });
          recordedAudio.src = URL.createObjectURL(recBlob);
          recordedAudio.style.display = "";
          useRecordedBtn.style.display = "";
        };
        recMediaRecorder.start();
        recStartTime = Date.now();
        recInterval = setInterval(() => {
          let elapsed = Math.floor((Date.now() - recStartTime) / 1000);
          let m = String(Math.floor(elapsed / 60)).padStart(2, '0');
          let s = String(elapsed % 60).padStart(2, '0');
          recTimer.textContent = m + ":" + s;
        }, 500);
        startRecBtn.disabled = true;
        stopRecBtn.disabled = false;
      } catch (err) {
        showNotif("Recording error: " + err.message, "var(--danger)");
      }
    };
    stopRecBtn.onclick = () => {
      if (recMediaRecorder && recMediaRecorder.state === "recording") {
        recMediaRecorder.stop();
        startRecBtn.disabled = false;
        stopRecBtn.disabled = true;
        clearInterval(recInterval);
      }
      if (mediaStream) {
        mediaStream.getTracks().forEach(track => track.stop());
      }
    };
    useRecordedBtn.onclick = async () => {
      if (!recBlob) return;
      // Use a random name and .webm extension
      const random4 = Math.random().toString(36).substring(2, 6);
      const file = new File([recBlob], `${random4}_${Date.now()}.webm`, { type: "audio/webm" });
      showPreview(file, "audio");
      previewType.textContent = "Uploading...";
      linkActions.classList.add("hidden");
      await doUpload(file, "audio");
      audioRecordSection.style.display = "none";
    };

    // ========== COPY TO CLIPBOARD ==========
    copyBtn.onclick = () => {
      if (!fileLink.value) return;
      navigator.clipboard.writeText(fileLink.value);
      showNotif("Copy link successfully!");
    };

    function capitalize(str) {
      return str.charAt(0).toUpperCase() + str.slice(1);
    }
  </script>
</body>
</html>
